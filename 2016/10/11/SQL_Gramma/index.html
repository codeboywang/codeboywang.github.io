<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Simple SQL Gramma | 泡饭</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Simple SQL Gramma</h1><a id="logo" href="/.">泡饭</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Simple SQL Gramma</h1><div class="post-meta">Oct 11, 2016<span> | </span><span class="category"><a href="/categories/Language/">Language</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a data-disqus-identifier="2016/10/11/SQL_Gramma/" href="/2016/10/11/SQL_Gramma/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#【建数据库】"><span class="toc-text">【建数据库】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#【建表-主键外键】"><span class="toc-text">【建表-主键外键】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#【插入-更新-删除-连接-查找】"><span class="toc-text">【插入-更新-删除-连接-查找】</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#增"><span class="toc-text">增</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#改"><span class="toc-text">改</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除"><span class="toc-text">删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#连接"><span class="toc-text">连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查找"><span class="toc-text">查找</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#【统计函数-排序】"><span class="toc-text">【统计函数-排序】</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#COUNT"><span class="toc-text">COUNT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MIN-MAX"><span class="toc-text">MIN_MAX</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SUM"><span class="toc-text">SUM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AVG"><span class="toc-text">AVG</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ORDER-BY"><span class="toc-text">ORDER BY</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#【分组】"><span class="toc-text">【分组】</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#GROUP-BY"><span class="toc-text">GROUP BY</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#【条件】"><span class="toc-text">【条件】</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WHERE"><span class="toc-text">WHERE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HAVING"><span class="toc-text">HAVING</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#【存储过程】"><span class="toc-text">【存储过程】</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#普通"><span class="toc-text">普通</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#有返回值"><span class="toc-text">有返回值</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#【备份-恢复】"><span class="toc-text">【备份-恢复】</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#全库备份"><span class="toc-text">全库备份</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#日志备份"><span class="toc-text">日志备份</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#差异备份"><span class="toc-text">差异备份</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#【索引】"><span class="toc-text">【索引】</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#多项非聚簇索引"><span class="toc-text">多项非聚簇索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#聚簇索引"><span class="toc-text">聚簇索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#普通非聚簇索引"><span class="toc-text">普通非聚簇索引</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#【安全-权限】"><span class="toc-text">【安全-权限】</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#授权"><span class="toc-text">授权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#收权"><span class="toc-text">收权</span></a></li></ol></li></ol></div></div><div class="post-content"><p> SQL代码整理<br>Beyond大舌头之SQL代码整理。<br>诶，数据库要考试了，脑子一团浆糊。花了一点时间整理代码，这儿的肯定不全。希望对大家有所帮助。(上个学期写的)<br>好啦，现在又在学习Oracle的数据库了，发现很多知识点我以前没有记录，现在补充一点吧。<br>该版本基本完善了所有的SQL的基础语言。</p>
<ul>
<li>初稿2016-05-22 23:00:00</li>
<li>一改2016-10-11 14:41:00</li>
</ul>
<p><strong>注意</strong>sql语言不分大小写，所以我没有同一大小写。</p>
<h1 id="【建数据库】"><a href="#【建数据库】" class="headerlink" title="【建数据库】"></a>【建数据库】</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">database</span> TS</div><div class="line"><span class="keyword">go</span></div><div class="line"><span class="keyword">use</span> TS</div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure>
<hr>
<h1 id="【建表-主键外键】"><a href="#【建表-主键外键】" class="headerlink" title="【建表-主键外键】"></a>【建表-主键外键】</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> Student</div><div class="line">(</div><div class="line">  Sno <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">constraint</span> pk_stu primary <span class="keyword">key</span>,<span class="comment">------主键</span></div><div class="line">  Sname <span class="built_in">varchar</span>(<span class="number">20</span>),</div><div class="line">  Ssex <span class="built_in">varchar</span>(<span class="number">2</span>),</div><div class="line">  Sage <span class="built_in">int</span>,</div><div class="line">  Sdept <span class="built_in">varchar</span>(<span class="number">2</span>)</div><div class="line">)</div><div class="line"><span class="keyword">Go</span></div><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> Course</div><div class="line">(</div><div class="line">  Cno <span class="built_in">int</span> <span class="keyword">constraint</span> pk_cou primary <span class="keyword">key</span>,</div><div class="line">  Cname <span class="built_in">varchar</span>(<span class="number">20</span>),</div><div class="line">  Cpno <span class="built_in">int</span> <span class="keyword">constraint</span> fk_cou_cpno <span class="keyword">references</span> Course(Cno),<span class="comment">----外键</span></div><div class="line">  Ccredit <span class="built_in">int</span></div><div class="line">)</div><div class="line"><span class="keyword">Go</span></div><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> SC</div><div class="line">(</div><div class="line">  Sno <span class="built_in">varchar</span>(<span class="number">10</span>)  <span class="keyword">constraint</span> fk_sc_sno <span class="keyword">references</span> Student(Sno),</div><div class="line">  Cno <span class="built_in">int</span> <span class="keyword">constraint</span> fk_sc_cno <span class="keyword">references</span> Course(Cno),</div><div class="line">  Grade <span class="built_in">numeric</span>(<span class="number">4</span>,<span class="number">1</span>),</div><div class="line">  <span class="keyword">constraint</span> pk_sc primary <span class="keyword">key</span>(Sno,Cno), <span class="comment">-------联合主键</span></div><div class="line">)</div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure>
<hr>
<h1 id="【插入-更新-删除-连接-查找】"><a href="#【插入-更新-删除-连接-查找】" class="headerlink" title="【插入-更新-删除-连接-查找】"></a>【插入-更新-删除-连接-查找】</h1><h2 id="增"><a href="#增" class="headerlink" title="增"></a>增</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student </div><div class="line"><span class="keyword">values</span>(<span class="string">'200215121'</span>,<span class="string">'李勇'</span>,<span class="string">'男'</span>,<span class="number">20</span>,<span class="string">'CS'</span>)</div></pre></td></tr></table></figure>
<h2 id="改"><a href="#改" class="headerlink" title="改"></a>改</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">update</span> Student</div><div class="line">  <span class="keyword">set</span> Sage=<span class="number">21</span></div><div class="line">  <span class="keyword">where</span> Sno = <span class="number">200215121</span></div></pre></td></tr></table></figure>
<p>改<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">update</span> Student</div><div class="line">  <span class="keyword">set</span> Sage=<span class="number">21</span></div></pre></td></tr></table></figure></p>
<p>改表格字加列<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Alter</span> <span class="keyword">table</span> Student <span class="keyword">add</span> S_entrance <span class="built_in">Date</span></div></pre></td></tr></table></figure></p>
<p>改表格之改类型<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Alter</span> <span class="keyword">table</span> Student </div><div class="line"><span class="keyword">Alter</span> <span class="keyword">column</span> Sage <span class="built_in">int</span></div></pre></td></tr></table></figure></p>
<p>改表格之约束条件<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Alter</span> <span class="keyword">table</span> Student <span class="keyword">Alter</span> <span class="keyword">Unique</span>(Cname)</div></pre></td></tr></table></figure></p>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p>删一条信息<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Delete</span> <span class="keyword">from</span> Student</div><div class="line"><span class="keyword">Where</span> Sno=<span class="number">200215121</span></div></pre></td></tr></table></figure></p>
<p>删表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">drop</span> <span class="keyword">database</span> <span class="keyword">test</span></div></pre></td></tr></table></figure></p>
<h2 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Select</span> Student.Sno,Sname,Ssex,Sage,Sdept,Cno,Grade</div><div class="line"><span class="keyword">From</span> Student <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> SC <span class="keyword">ON</span>(Student.Sno=SC.Sno)</div></pre></td></tr></table></figure>
<p>左外连接，显示左边的所有元素。同理右外连接。</p>
<h2 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student</div><div class="line"><span class="keyword">where</span> birthday <span class="keyword">NOT</span> <span class="keyword">BETWEEN</span> <span class="keyword">TO_DATE</span> (<span class="string">'19910101'</span>,<span class="string">'YYYYMMDD'</span>) <span class="keyword">AND</span> (<span class="string">'19911231'</span>,<span class="string">'YYYYMMDD'</span>)</div></pre></td></tr></table></figure>
<hr>
<h1 id="【统计函数-排序】"><a href="#【统计函数-排序】" class="headerlink" title="【统计函数-排序】"></a>【统计函数-排序】</h1><h2 id="COUNT"><a href="#COUNT" class="headerlink" title="COUNT"></a>COUNT</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="built_in">COUNT</span>(DISTNCT 产地)</div><div class="line"><span class="keyword">from</span> 商品信息 <span class="keyword">where</span> 单价&gt;<span class="number">800</span></div></pre></td></tr></table></figure>
<h2 id="MIN-MAX"><a href="#MIN-MAX" class="headerlink" title="MIN_MAX"></a>MIN_MAX</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="built_in">MAX</span>(成绩) <span class="keyword">as</span> 最高成绩 , <span class="built_in">MIN</span>(成绩) <span class="keyword">as</span> 最低成绩</div><div class="line"><span class="keyword">from</span> 学生成绩</div></pre></td></tr></table></figure>
<h2 id="SUM"><a href="#SUM" class="headerlink" title="SUM"></a>SUM</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="built_in">SUM</span>(成绩) <span class="keyword">as</span> 成绩总和</div><div class="line"><span class="keyword">from</span> 学生成绩</div></pre></td></tr></table></figure>
<h2 id="AVG"><a href="#AVG" class="headerlink" title="AVG"></a>AVG</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="built_in">AVG</span>(成绩) <span class="keyword">as</span> 平均成绩</div><div class="line"><span class="keyword">from</span> 学生成绩</div></pre></td></tr></table></figure>
<h2 id="ORDER-BY"><a href="#ORDER-BY" class="headerlink" title="ORDER BY"></a>ORDER BY</h2><p>降序<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> 学生成绩</div><div class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 数学成绩 <span class="keyword">DESC</span></div></pre></td></tr></table></figure></p>
<p>升序<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> 学生成绩</div><div class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 数学成绩</div></pre></td></tr></table></figure></p>
<hr>
<h1 id="【分组】"><a href="#【分组】" class="headerlink" title="【分组】"></a>【分组】</h1><h2 id="GROUP-BY"><a href="#GROUP-BY" class="headerlink" title="GROUP BY"></a>GROUP BY</h2><blockquote>
<ul>
<li>select子句后只有两种表达式：统计函数和进行分组的列名</li>
<li>没有出现在GROUP BY 之后的列名不能出现在SELECT子句中，但是GROUP BY子句后面的列名何可不出现在SELECT子句中</li>
<li>如果用了where子句，分组的数据必须满足where子句的条件</li>
<li>系统默认是升序，可以用order by改成降序</li>
</ul>
</blockquote>
<p>统计函数对查询出的每一组数据进行分类统计<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> 供应商编号,<span class="built_in">COUNT</span>(*) <span class="keyword">as</span> 商品种类</div><div class="line"><span class="keyword">from</span> 商品信息</div><div class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> 供应商编号</div></pre></td></tr></table></figure></p>
<p><strong>错误示例</strong><br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> 供应商编号 ,<span class="built_in">COUNT</span>(*) <span class="keyword">as</span> 商品种类 , 产地</div><div class="line"><span class="keyword">from</span> 商品信息 <span class="keyword">GROUP</span> <span class="keyword">BY</span> 供应商编号</div></pre></td></tr></table></figure></p>
<blockquote>
<p>与第一条注意事项冲突，在Group by 后加上‘产地,’就可以</p>
</blockquote>
<hr>
<h1 id="【条件】"><a href="#【条件】" class="headerlink" title="【条件】"></a>【条件】</h1><h2 id="WHERE"><a href="#WHERE" class="headerlink" title="WHERE"></a>WHERE</h2><blockquote>
<p>突然懒得写了。</p>
</blockquote>
<h2 id="HAVING"><a href="#HAVING" class="headerlink" title="HAVING"></a>HAVING</h2><blockquote>
<p>WHERE子句只能接受FROM的子句输出<br>HAVING子句可以 接受来自GROUP BY,WHERE,FROM子句输入</p>
</blockquote>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> 产地,供应商编号,<span class="built_in">COUNT</span>(商品名称) <span class="keyword">as</span> 商品种类</div><div class="line"><span class="keyword">from</span> 商品信息</div><div class="line"><span class="keyword">where</span> 单价&gt;<span class="number">800</span></div><div class="line"><span class="keyword">group</span> <span class="keyword">by</span> (产地,供应商编号)</div><div class="line"><span class="keyword">having</span> <span class="built_in">count</span>(商品名称)&gt;=<span class="number">2</span></div></pre></td></tr></table></figure>
<blockquote>
<p>上例<br>HACING子句是将要应用的表达式中最后的一个子句，并且它与分组数据有关，而与单个的行无关。</p>
</blockquote>
<hr>
<h1 id="【存储过程】"><a href="#【存储过程】" class="headerlink" title="【存储过程】"></a>【存储过程】</h1><h2 id="普通"><a href="#普通" class="headerlink" title="普通"></a>普通</h2><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">proc_StudentLoadByPrimaryKey</span></span></div><div class="line"><span class="params">(</span></div><div class="line">@Sno varchar(10)</div><div class="line">)</div><div class="line"><span class="title">AS</span></div><div class="line"><span class="title">BEGIN</span></div><div class="line"><span class="title">Select</span> * <span class="title">from</span> <span class="title">student</span> <span class="title">where</span> <span class="title">sno</span>=@<span class="title">sno</span></div><div class="line"><span class="title">END</span></div><div class="line"><span class="title">GO</span></div><div class="line"><span class="title">exec</span> <span class="title">proc_StudentLoadByPrimaryKey</span>   '200215122'</div></pre></td></tr></table></figure>
<h2 id="有返回值"><a href="#有返回值" class="headerlink" title="有返回值"></a>有返回值</h2><figure class="highlight tcl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">create <span class="keyword">proc</span><span class="title"> proc_Query_Code</span></div><div class="line">(</div><div class="line">       @ad_num<span class="title"> integer,</span></div><div class="line">       @ad_code<span class="title"> varchar(10)</span> output</div><div class="line">)<span class="title"></span></div><div class="line">  as <span class="title"></span></div><div class="line">  begin</div><div class="line"><span class="title">  select</span> @ad_code=[Ad-code]<span class="title">  from</span> Administrator<span class="title"> where</span> [Ad-num]=@ad_num<span class="title"></span></div><div class="line">  end</div><div class="line"><span class="title">  Go</span></div><div class="line"><span class="title">  declare</span> @temp<span class="title"> varchar(10)</span></div><div class="line"><span class="title">  exec</span> <span class="title"> proc_Query_Code</span>   1178,@temp<span class="title"> output</span></div><div class="line"><span class="title">  print</span> @temp</div></pre></td></tr></table></figure>
<hr>
<h1 id="【备份-恢复】"><a href="#【备份-恢复】" class="headerlink" title="【备份-恢复】"></a>【备份-恢复】</h1><h2 id="全库备份"><a href="#全库备份" class="headerlink" title="全库备份"></a>全库备份</h2><p>全库备份的是数据<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">backup</span> <span class="keyword">database</span> <span class="keyword">test</span></div><div class="line"><span class="keyword">to</span> disk=<span class="string">'d:\test-total'</span></div><div class="line"><span class="keyword">restore</span> <span class="keyword">database</span> <span class="keyword">test</span></div><div class="line"><span class="keyword">from</span> disk=<span class="string">'d:\test-total'</span></div><div class="line"><span class="keyword">with</span> norecovery <span class="comment">-----此行关键字表示数据库还没有完全恢复，此时数据库不可用</span></div></pre></td></tr></table></figure></p>
<h2 id="日志备份"><a href="#日志备份" class="headerlink" title="日志备份"></a>日志备份</h2><p>日志备份的是操作<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">backup</span> <span class="keyword">log</span> <span class="keyword">test</span> </div><div class="line"><span class="keyword">to</span> disk=<span class="string">'d:\test-log1'</span></div><div class="line"><span class="keyword">restore</span> <span class="keyword">database</span> <span class="keyword">test</span></div><div class="line"><span class="keyword">from</span> disk=<span class="string">'d:\test-log1'</span></div><div class="line"><span class="keyword">with</span> norecovery</div></pre></td></tr></table></figure></p>
<h2 id="差异备份"><a href="#差异备份" class="headerlink" title="差异备份"></a>差异备份</h2><p>备份的是数据<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">backup</span> <span class="keyword">database</span> <span class="keyword">test</span></div><div class="line"><span class="keyword">to</span> disk=<span class="string">'d:\test-dif'</span></div><div class="line"><span class="keyword">with</span> differential</div><div class="line"><span class="keyword">restore</span> <span class="keyword">database</span> <span class="keyword">test</span></div><div class="line"><span class="keyword">from</span> disk=<span class="string">'d:\test-dif'</span></div><div class="line"><span class="keyword">with</span> norecovery</div></pre></td></tr></table></figure></p>
<p>Tips：若要恢复差异备份，在此次差异备份到上次全库备份之间的其它备份操作都不用恢复。</p>
<p>例：7:00全库备份、8:00日志备份、9:00差异备份。</p>
<p>恢复全库备份后恢复差异备份，数据库即恢复到9:00的状态。</p>
<hr>
<h1 id="【索引】"><a href="#【索引】" class="headerlink" title="【索引】"></a>【索引】</h1><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">create nonclustered index idx_s_c</div><div class="line">on s_c(<span class="name">c_num</span>) include(<span class="name">s_num</span>)</div></pre></td></tr></table></figure>
<h2 id="多项非聚簇索引"><a href="#多项非聚簇索引" class="headerlink" title="多项非聚簇索引"></a>多项非聚簇索引</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> clustered <span class="keyword">index</span> idx_stu</div><div class="line"><span class="keyword">on</span> stu(<span class="keyword">num</span>)</div></pre></td></tr></table></figure>
<h2 id="聚簇索引"><a href="#聚簇索引" class="headerlink" title="聚簇索引"></a>聚簇索引</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> nonclustered <span class="keyword">index</span> idx_stu_name</div><div class="line"><span class="keyword">on</span> stu(<span class="keyword">name</span>)</div></pre></td></tr></table></figure>
<h2 id="普通非聚簇索引"><a href="#普通非聚簇索引" class="headerlink" title="普通非聚簇索引"></a>普通非聚簇索引</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">create ndex idx_stu_name</div><div class="line"><span class="keyword">on</span> stu(<span class="built_in">name</span>)</div></pre></td></tr></table></figure>
<p>普通索引</p>
<hr>
<h1 id="【安全-权限】"><a href="#【安全-权限】" class="headerlink" title="【安全-权限】"></a>【安全-权限】</h1><h2 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Grant</span> <span class="keyword">select</span> <span class="keyword">on</span> <span class="keyword">table</span> Student</div><div class="line"></div><div class="line"><span class="keyword">To</span> u1</div><div class="line"></div><div class="line"><span class="keyword">With</span> <span class="keyword">grant</span> <span class="keyword">option</span></div><div class="line"></div><div class="line"><span class="comment">-----u1 可以授权其它用户</span></div><div class="line"></div><div class="line"><span class="keyword">Grant</span> all <span class="keyword">privileges</span> <span class="keyword">on</span> <span class="keyword">table</span> Student,Course</div><div class="line"></div><div class="line"><span class="keyword">To</span> u2,u3</div><div class="line"></div><div class="line"><span class="comment">-------授权所有权限</span></div><div class="line"></div><div class="line"><span class="keyword">Grant</span> <span class="keyword">select</span> <span class="keyword">on</span> <span class="keyword">table</span> SC </div><div class="line"></div><div class="line"><span class="keyword">To</span> <span class="keyword">public</span></div><div class="line"></div><div class="line"><span class="comment">-------授权所有用户</span></div></pre></td></tr></table></figure>
<h2 id="收权"><a href="#收权" class="headerlink" title="收权"></a>收权</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Revoke</span> <span class="keyword">update</span>(Sno)</div><div class="line"><span class="keyword">On</span> <span class="keyword">table</span> Student</div><div class="line"><span class="keyword">From</span> u4</div><div class="line"><span class="keyword">Revoke</span> <span class="keyword">insert</span> <span class="keyword">on</span> <span class="keyword">table</span> SC</div><div class="line"><span class="keyword">From</span> u5 </div><div class="line"><span class="keyword">Cascade</span></div><div class="line"><span class="comment">-----联级收回，比如u5以前授权给u6，u6给u7，这会儿他们全没权限了。传说中的连根拔起。</span></div></pre></td></tr></table></figure></div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="beyondtech.org/2016/10/11/SQL_Gramma/" data-id="cj9s2ew0f008cuewahaou0rai" class="article-share-link">分享</a><div class="tags"><a href="/tags/SQL/">SQL</a></div><div class="post-nav"><a href="/2016/10/17/SQL各类连接/" class="pre">SQL各类连接和集合操作</a><a href="/2016/10/09/SQLdeveloper/" class="next">SQLdeveloper</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'beyondwang';
var disqus_identifier = '2016/10/11/SQL_Gramma/';
var disqus_title = 'Simple SQL Gramma';
var disqus_url = 'beyondtech.org/2016/10/11/SQL_Gramma/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/favicon.ico',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//beyondwang.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="beyondtech.org"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ariticle/">Ariticle</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Daily/">Daily</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Document/">Document</a><span class="category-list-count">44</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Experience/">Experience</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Expirence/">Expirence</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Language/">Language</a><span class="category-list-count">30</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Resource/">Resource</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/服务器/" style="font-size: 15px;">服务器</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a> <a href="/tags/经典问题/" style="font-size: 15px;">经典问题</a> <a href="/tags/DP/" style="font-size: 15px;">DP</a> <a href="/tags/项目/" style="font-size: 15px;">项目</a> <a href="/tags/SQL/" style="font-size: 15px;">SQL</a> <a href="/tags/ASP-NET/" style="font-size: 15px;">ASP.NET</a> <a href="/tags/Feeling/" style="font-size: 15px;">Feeling</a> <a href="/tags/VR-AR/" style="font-size: 15px;">VR/AR</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Bash/" style="font-size: 15px;">Bash</a> <a href="/tags/MVC/" style="font-size: 15px;">MVC</a> <a href="/tags/Thread/" style="font-size: 15px;">Thread</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/面向对象/" style="font-size: 15px;">面向对象</a> <a href="/tags/串/" style="font-size: 15px;">串</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/ACM/" style="font-size: 15px;">ACM</a> <a href="/tags/Oracle/" style="font-size: 15px;">Oracle</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/STL/" style="font-size: 15px;">STL</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/IOS/" style="font-size: 15px;">IOS</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/VB/" style="font-size: 15px;">VB</a> <a href="/tags/VR-AR/" style="font-size: 15px;">VR-AR</a> <a href="/tags/数论/" style="font-size: 15px;">数论</a> <a href="/tags/平面几何/" style="font-size: 15px;">平面几何</a> <a href="/tags/小说/" style="font-size: 15px;">小说</a> <a href="/tags/随笔/" style="font-size: 15px;">随笔</a> <a href="/tags/Tree/" style="font-size: 15px;">Tree</a> <a href="/tags/快速/" style="font-size: 15px;">快速</a> <a href="/tags/记事本/" style="font-size: 15px;">记事本</a> <a href="/tags/游戏开发/" style="font-size: 15px;">游戏开发</a> <a href="/tags/矩阵/" style="font-size: 15px;">矩阵</a> <a href="/tags/Resource/" style="font-size: 15px;">Resource</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/11/08/Facebook360学习总结/">Facebook360学习总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/01/VR摄影相关概念学习/">VR摄影相关概念学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/22/CALIBRATION/">facebook/Surround360的翻译</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/02/CodeIgniter入门理解/">CodeIgniter入门理解以及其他知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/11/Mysql-Proxy读写分离/">Mysql-Proxy读写分离</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/10/MYSQL主从实践/">Mysql主从双机备份</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/09/SQL-Tips/">SQL Tips</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/18/计算机操作系统复习/">计算机操作系统复习提纲</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/10/Mysql设置/">CentOS_7 Mysql 安装设置</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/29/PHP实战/">PHP实战</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//beyondwang.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://xuanwo.org/" title="漩涡大神" target="_blank">漩涡大神</a><ul></ul><a href="https://fanzheng.org/" title="范神" target="_blank">范神</a><ul></ul><a href="http://www.liaoxuefeng.com/" title="廖雪峰" target="_blank">廖雪峰</a><ul></ul><a href="https://teddysun.com/" title="秋水逸冰" target="_blank">秋水逸冰</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">泡饭.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>